/*
 Minified and unminified versions of this file are located in the same directory. Access unminified version by replacing the .min.js extension with .js This file was copied from WordPress, copyright 2011-2019 by the contributors,
released under the GNU General Public License version 2 or later, licensed
by this project under the GPLv3 (see ../license.txt for GPLv3).

This file also contains code copied from and based on TinyMCE, copyright
Ephox Corporation, licensed by this project under the GPLv3 (see ../license.txt).

Original file path: wp-includes/js/tinymce/plugins/wpgallery/plugin.js
Also includes code from wp-includes/js/tinymce/plugins/image/plugin.js
Also includes code from wp-includes/js/tinymce/themes/modern/theme.js
*/
(function(){var f=jQuery,k,t,q;tinymce.PluginManager.add("agsdi_icons",function(g){function D(){return{icon:"agsdi-aspengrovestudios",color:"",color2:"",color3:"",size:"48px",title:"","class":""}}function E(a,b){b=f(b);var c="",d={"data-icon":a.icon,"class":"agsdi-icon"+(a["class"]?" "+a["class"]:"")};a.icon&&"agsdix-mcip-"===a.icon.substring(0,12)?(a.color&&(d["data-color1"]=a.color),a.color2&&(d["data-color2"]=a.color2),a.color3&&(d["data-color3"]=a.color3)):a.color&&(c+="color:"+a.color+"!important;");
a.size&&(c+="font-size:"+a.size+";");a.title&&a.title.trim()||(a.title=y(a.icon));d["data-mce-style"]=c;d.style=c;b.attr(d).text(a.title)}function y(a){var b=a.lastIndexOf(" ");b=a.indexOf("-",-1===b?0:b);-1!==b&&"agsdi-"!==a.substring(0,6)&&"agsdix-fa"!==a.substring(0,9)&&(b=a.indexOf("-",b+1),"agsdix-mcip-"===a.substr(0,12)&&(b=a.indexOf("-",b+1)));return(-1===b?a:a.substr(b+1)).replace(/\-/g," ")+" icon"}function w(a){if(a=a.selection.getNode()){var b=f(a);b.is("a")&&(b=b.children("span.agsdi-icon:first"));
if(!b.is("span.agsdi-icon"))return null}return b[0]}function F(a){if(a=w(a)){a=f(a);var b=D();b.icon=a.attr("data-icon");var c="agsdix-mcip-"===b.icon.substring(0,12);b.title=a.text();b.title===y(b.icon)&&delete b.title;b["class"]=a.clone().removeClass("agsdi-icon agsdi-selected").attr("class");var d=a.attr("style");if(d){d=d.split(";");for(var e=0;e<d.length;++e){d[e]=d[e].trim();var r=d[e].indexOf(":");if(-1!==r)switch(d[e].substr(0,r).toLowerCase()){case "color":c||(b.color=d[e].substr(r+1).trim(),
"!important"===b.color.substr(-10).toLowerCase()&&(b.color=b.color.substr(0,b.color.length-10).trim()));break;case "font-size":b.size=d[e].substr(r+1).trim()}}}c&&(b.color=a.attr("data-color1"),b.color2=a.attr("data-color2"),b.color3=a.attr("data-color3"));a=b}else a=D();return a}function J(a){function b(c){var d=c.control.rootControl.find("#size")[0];d.value(Math.round(c.control.value())+"px");d.fire("change",{noSliderUpdate:!0})}return[{name:"panel-main",type:"panel",layout:"grid",columns:3,alignH:["stretch",
"left","right"],alignV:"stretch",items:[{name:"icon",type:"agsdi-icon-picker",onchange:function(c){c=this.value();this.rootControl.find("#preview")[0].setIcon(c);"agsdix-smc-"===c.substr(0,11)?(this.rootControl.find("#color").parent().hide(),this.rootControl.find("#colorpicker").hide(),this.rootControl.find("#multi-color-message").show()):(this.rootControl.find("#color").parent().show(),this.rootControl.find("#multi-color-message").hide());var d="agsdix-mcip-"===c.substr(0,12)&&window.wadi_svg_icons&&
window.wadi_svg_icons[c]&&window.wadi_svg_icons[c].colors?window.wadi_svg_icons[c].colors:1;2<d?this.rootControl.find("#color3").parent().show():(this.rootControl.find("#color3").parent().hide(),this.rootControl.find("#colorpicker3").hide());1<d?this.rootControl.find("#color2").parent().show():(this.rootControl.find("#color2").parent().hide(),this.rootControl.find("#colorpicker2").hide());f(this.rootControl.find("#title")[0].getEl()).attr("placeholder",y(c))},onload:function(){var c=this.value(),
d=this.rootControl.find("#preview")[0];d&&d.setIcon(c);this.didFirstLoad||"agsdix-mcip-"!==c.substring(0,12)||this.setShowMulticolorIcons(!0);this.didFirstLoad=!0}},{type:"container",layout:"fit",items:[{type:"form",items:[{name:"color",type:"textbox",classes:"agsdi-color-field agsdi-color-field-1",label:"Icon color",onchange:function(c){var d=c.control.rootControl,e=this.state.get("value");c.noUpdatePicker||(c=d.find("#colorpicker")[0],c.value(e),c._repaint());d.find("#preview")[0].setColor(e)}},
{name:"colorpicker",type:"colorpicker",onchange:function(c){var d=c.control.rootControl.find("#color")[0];d.state.set("value",c.control.value());d.fire("change",{noUpdatePicker:!0})}},{name:"color2",type:"textbox",classes:"agsdi-color-field agsdi-color-field-2",label:"Icon color 2",onchange:function(c){var d=c.control.rootControl,e=this.state.get("value");c.noUpdatePicker||(c=d.find("#colorpicker2")[0],c.value(e),c._repaint());d.find("#preview")[0].setColor2(e)}},{name:"colorpicker2",type:"colorpicker",
onchange:function(c){var d=c.control.rootControl.find("#color2")[0];d.state.set("value",c.control.value());d.fire("change",{noUpdatePicker:!0})}},{name:"color3",type:"textbox",classes:"agsdi-color-field agsdi-color-field-3",label:"Icon color 3",onchange:function(c){var d=c.control.rootControl,e=this.state.get("value");c.noUpdatePicker||(c=d.find("#colorpicker3")[0],c.value(e),c._repaint());d.find("#preview")[0].setColor3(e)}},{name:"colorpicker3",type:"colorpicker",onchange:function(c){var d=c.control.rootControl.find("#color3")[0];
d.state.set("value",c.control.value());d.fire("change",{noUpdatePicker:!0})}},{name:"multi-color-message",type:"agsdi-message",hidden:!0,className:"agsdi-multi-color-message",message:ags_divi_icons_tinymce_config.multiColorMessage},{name:"size",type:"textbox",label:"Icon size",onchange:function(c){var d=this.value().trim();if(!c.noSliderUpdate&&"px"===d.substr(-2).toLowerCase()){var e=d.substr(0,d.length-2);isNaN(e)||(e=Math.round(e),16>e?e=16:128<e&&(e=128),c.control.rootControl.find("#size_slider")[0].value(e))}c.control.rootControl.find("#preview")[0].setSize(d)}},
{name:"size_slider",type:"slider",minValue:16,maxValue:128,value:16,previewFilter:function(c){return Math.round(c)+"px"},ondrag:b,ondragstart:b,ondragend:b},{name:"title",type:"textbox",label:"Icon title"},{name:"class",type:"textbox",label:"Icon class(es)"},{name:"style-inherit-message",type:"agsdi-message",className:"agsdi-style-inherit-message",message:ags_divi_icons_tinymce_config.styleInheritMessage}]}]},{name:"preview",type:"agsdi-icon-preview"}]},{type:"agsdi-credit"}]}function K(a){for(var b=
1;b<arguments.length;b++);var c=Array(arguments.length-1);for(b=1;b<arguments.length;b++)c[b-1]=arguments[b];return function(){for(var d=0;d<arguments.length;d++);d=Array(arguments.length);for(var e=0;e<d.length;e++)d[e]=arguments[e];d=c.concat(d);return a.apply(null,d)}}function z(a){return{open:function(){var b=w(a),c=F(a);var d=a.windowManager.open({title:wp.i18n.__("Insert Icon","ds-icon-expansion"),data:c,body:J(a),minWidth:800,classes:"agsdi-insert-dialog",onSubmit:K(function(e,r){if(b){var l=
f(b).parent("a");e.selection.select(l.length?l[0]:b)}var n=r.control.getRoot();e.undoManager.transact(function(){var h=Object.assign(F(e),n.toJSON()),m=w(e);m?h.icon?(m=w(e),E(h,m),e.selection.select(m)):m&&(e.dom.remove(m),e.focus(),e.nodeChanged(),e.dom.isEmpty(e.getBody())&&(e.setContent(""),e.selection.setCursorLocation())):h.icon&&(m=f("<span>").attr({contenteditable:!1}).addClass("agsdi-icon"),E(h,m[0]),h=m[0],e.dom.setAttrib(h,"data-mce-id","__mcenew"),e.focus(),e.selection.setContent(h.outerHTML),
h=e.dom.select('*[data-mce-id="__mcenew"]')[0],e.dom.setAttrib(h,"data-mce-id",null),e.selection.select(h))})},a)});d.find("#icon,#color,#color2,#color3,#size").fire("change");d.find("#colorpicker,#colorpicker2,#colorpicker3").hide();jQuery(d.$el[0]).on("focus",".mce-agsdi-color-field",function(){var e=jQuery(this);colorpickerId=e.hasClass("mce-agsdi-color-field-2")?"#colorpicker2":e.hasClass("mce-agsdi-color-field-3")?"#colorpicker3":"#colorpicker";d.find(colorpickerId).show()});jQuery(d.$el[0]).on("blur",
".mce-agsdi-color-field",function(){var e=jQuery(this);colorpickerId=e.hasClass("mce-agsdi-color-field-2")?"#colorpicker2":e.hasClass("mce-agsdi-color-field-3")?"#colorpicker3":"#colorpicker";d.find(colorpickerId).hide()})}}}function G(a){return function(b){for(var c=b.length,d;c--;){d=b[c];var e=d.attr("class");e&&/\bagsdi\-icon\b/.test(e)&&d.attr("contenteditable",a?"false":null)}}}function A(){var a=g.dom.select("span.agsdi-icon");a.length&&f(a).data("agsdi-selected",null)}tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");
g.on("Init",function(){agsdi_render_icons(g.dom.doc.body,!0,!0);var a=window.MutationObserver?window.MutationObserver:window.WebkitMutationObserver;a&&(new a(function(b){for(var c=0;c<b.length;++c){var d=b[c];if(d.addedNodes&&d.addedNodes.length)for(var e=0;e<d.addedNodes.length;++e)agsdi_render_icons(d.addedNodes[e],!0,!0);else agsdi_render_icons(d.target,!0,!0)}})).observe(g.dom.doc.body,{childList:!0,subtree:!0,attributeFilter:["data-icon"]})});var u=tinymce.ui.Widget.extend({init:function(a){this._super(a);
this.classes.add("agsdi-icon-picker");this.isFreeVersion=!0;this.didFirstLoad=!1;k=t;q=ags_divi_icons_config.singleColorFilters},repaint:function(){var a=this.getEl().style;var b=this._layoutRect;var c=this._lastRepaintRect||{};var d=this.borderBox;var e=d.left+d.right+8;d=d.top+d.bottom;b.x!==c.x&&(a.left=b.x+"px",c.x=b.x);b.y!==c.y&&(a.top=b.y+"px",c.y=b.y);b.w!==c.w&&(a.width=b.w-e+"px",c.w=b.w);b.h!==c.h&&(a.height=b.h-d+"px",c.h=b.h);this._lastRepaintRect=c;this.fire("repaint",{},!1);return this},
renderHtml:function(){function a(){var l=f(b.getEl()),n=l.find(".agsdi-picker-filter-tinymce:first"),h=[];n.children(":not(:first-child)").remove();for(var m in q)for(var x=m.split(","),p=0,B=!1;p<x.length;++p){if("agsdix-mcip-"===x[p].substring(0,12))B=!0;else for(var C=0;C<k.length;++C)if(k[C].substring(0,x[p].length)===x[p]){B=!0;break}if(B){h.push([m,q[m]]);break}}h.sort(function(H,I){return I[1]<H[1]?1:I[1]>H[1]?-1:0});for(p=0;p<h.length;p++)f("<option>").val(h[p][0]).text(h[p][1]).appendTo(n);
n.change();var v=l.find(".agsdi-icons:first");b.isFreeVersion&&"multicolor"===l.find(".agsdi-picker-multicolor-select-tinymce:first").val()?v.empty().append(f("<div>").addClass("agsdi-pro-message").append(f("<span>").text(wp.i18n.__("This is a PRO feature.","ds-icon-expansion"))).append("<br>").append(f("<a>").attr({href:"#",target:"_blank"}).text(wp.i18n.__("Upgrade","ds-icon-expansion")))):(e(v),b.scrolledToSelected||(l=v.find(".agsdi-selected:first"),l.length&&l.parent().scrollTop(l.position().top),
b.scrolledToSelected=!0),b._handleScroll(v),setTimeout(function(){b._handleScroll(v)},200))}var b=this,c=f("<div>").attr("id",b._id).addClass(b.classes.toString());window.agsdi_tinymce_onMulticolorSelectChange=function(l){if(!b.isFreeVersion)if(f(l).val()){k=[];q={};for(var n in window.agsdi_multicolor.sets)q["agsdix-mcip-"+n+"-"]=window.agsdi_multicolor.sets[n],k=k.concat.apply(k,window.agsdi_multicolor.icons[n].map(function(h){return h.icons.map(function(m){return"agsdix-"+h.prefix.slice(0,-4)+
m})}))}else k=t,q=ags_divi_icons_config.singleColorFilters;a()};f("<select>").addClass("agsdi-picker-multicolor-select-tinymce").attr("onchange","agsdi_tinymce_onMulticolorSelectChange(this)").append(f("<option>").val("").text(wp.i18n.__("Single Color Icons","ds-icon-expansion"))).append(f("<option>").val("multicolor").text(wp.i18n.__("Multicolor Icons","ds-icon-expansion"))).appendTo(c);f("<select>").addClass("agsdi-picker-filter-tinymce").attr({onchange:"agsdi_filter("+JSON.stringify(b._id)+", this)"}).append(f("<option>").val("").text(wp.i18n.__("All Icons",
"ds-icon-expansion"))).appendTo(c);f("<input>").attr({type:"search",placeholder:wp.i18n.__("Search icons...","ds-icon-expansion"),oninput:"agsdi_search(this);"}).addClass("agsdi-picker-search-tinymce").appendTo(c);var d=f("<div>").addClass("agsdi-icons").appendTo(c),e=function(l){l.empty();var n=b.state.get("value");f.each(k,function(h,m){"agsdix-null"!=m&&(h=f("<span>").attr("data-icon-pre",m),m===n&&h.addClass("agsdi-selected"),h.appendTo(l))});b.fire("load")};f("<div>").text(wp.i18n.__("Loading icons...",
"ds-icon-expansion")).appendTo(d);if(k)setTimeout(a,500);else{var r=Date.now?Date.now():0;f.post(window.ajaxurl?window.ajaxurl:ETBuilderBackendDynamic.ajaxUrl,{action:"agsdi_get_icons"},function(l){l.success&&l.data&&(k=t=l.data);setTimeout(a,Math.max(1,500-((Date.now?Date.now():500)-r)))},"json")}return c[0].outerHTML},handleScroll:function(a){if(a.target){this.handleScrollTimeout&&clearTimeout(this.handleScrollTimeout);var b=this;this.handleScrollTimeout=setTimeout(function(){b._handleScroll(f(a.target))},
200)}},_handleScroll:function(a){var b=a.height();a.find("[data-icon-pre]:visible").each(function(){var c=f(this).position().top;-32<=c&&c<=b&&f(this).attr({"data-icon":f(this).attr("data-icon-pre"),"data-icon-pre":null})});a.find("[data-icon]").each(function(){var c=f(this),d=c.is(":visible")?c.position().top:-33;(-32>d||d>b)&&f(this).attr({"data-icon-pre":c.attr("data-icon"),"data-icon":null,"class":null})})},setShowMulticolorIcons(a){var b=f(this.getEl()).find(".agsdi-picker-multicolor-select-tinymce:first");
b.val()!==(a?"multicolor":"")&&b.val(a?"multicolor":"").trigger("change")},value:function(a){return arguments.length?(this.state.set("value",a),this):this.state.get("value")},postRender:function(){var a=this,b=f(a.getEl()).find(".agsdi-icons:first");a._super();b.on("click","[data-icon]",function(){var c=f(this).data("icon");a.state.set("value",c);a.fire("change")});b.on("scroll",function(c){a.handleScroll(c)}).on("agsdi:search agsdi:filter",function(){a._handleScroll(b)});a._handleScroll(b)},bindStates:function(){var a=
this;a.state.on("change:value",function(b){var c=f(a.getEl()).find(".agsdi-icons:first");c.find(".agsdi-selected").removeClass("agsdi-selected");c.find("[data-icon='"+b.value+"']:first").addClass("agsdi-selected")});return a._super()},remove:function(){this.$el.off();this._super()}});tinymce.ui.Factory.add("agsdi-icon-picker",u);u=tinymce.ui.Widget.extend({init:function(a){this._super(a);this.classes.add("agsdi-credit")},repaint:function(){var a=this.getEl().style;var b=this._layoutRect;var c=this._lastRepaintRect||
{};var d=this.borderBox;var e=d.left+d.right+8;d=d.top+d.bottom;b.x!==c.x&&(a.left=b.x+"px",c.x=b.x);b.y!==c.y&&(a.top=b.y+"px",c.y=b.y);b.w!==c.w&&(a.width=b.w-e+"px",c.w=b.w);b.h!==c.h&&(a.height=b.h-d+"px",c.h=b.h);this._lastRepaintRect=c;this.fire("repaint",{},!1);return this},renderHtml:function(){return f("<div>").attr("id",this._id).addClass(this.classes.toString()+" agsdi-picker-credit").html('WP &amp; Divi Icons by <a href="https://aspengrovestudios.com/?utm_source=wp-and-divi-icons&amp;utm_medium=plugin-credit-link&amp;utm_content=wp-editor" target="_blank">Aspen Grove Studios</a>')[0].outerHTML}});
tinymce.ui.Factory.add("agsdi-credit",u);u=tinymce.ui.Widget.extend({init:function(a){this._super(a);this.classes.add("agsdi-icon-preview");this.on("repaint",this.updateIconPreview)},repaint:function(){var a=this.getEl().style;var b=this._layoutRect;var c=this._lastRepaintRect||{};var d=this.borderBox;var e=d.left+d.right+8;d=d.top+d.bottom;b.x!==c.x&&(a.left=b.x+"px",c.x=b.x);b.y!==c.y&&(a.top=b.y+"px",c.y=b.y);b.w!==c.w&&(a.width=b.w-e+"px",c.w=b.w);b.h!==c.h&&(a.height=b.h-d+"px",c.h=b.h);this._lastRepaintRect=
c;this.fire("repaint",{},!1);return this},renderHtml:function(){var a=f("<div>").attr("id",this._id).addClass(this.classes.toString()).append(f("<label>").text(wp.i18n.__("Preview","ds-icon-expansion")));f("<div>").addClass("agsdi-icon-preview").appendTo(a);return a[0].outerHTML},updateIconPreview:function(){var a=f(this.getEl()).children(".agsdi-icon-preview").empty(),b=this.getIconPreview();a.append(b);b.css({left:(a.innerWidth()-b.width())/2+"px",top:(a.innerHeight()-b.height())/2+"px"})},getIconPreview:function(){var a=
f("<span>").attr("data-icon",this.settings.icon);this.settings.icon&&"agsdix-mcip-"===this.settings.icon.substring(0,12)?(this.settings.color&&a.attr("data-color1",this.settings.color),this.settings.color2&&a.attr("data-color2",this.settings.color2),this.settings.color3&&a.attr("data-color3",this.settings.color3)):this.settings.color&&a.css("color",this.settings.color);this.settings.size&&a.css("font-size",this.settings.size);return a},setIcon:function(a){this.settings.icon=a;this.updateIconPreview()},
setColor:function(a){this.settings.color=a;this.updateIconPreview()},setColor2:function(a){this.settings.color2=a;this.updateIconPreview()},setColor3:function(a){this.settings.color3=a;this.updateIconPreview()},setSize:function(a){this.settings.size=a;this.updateIconPreview()}});tinymce.ui.Factory.add("agsdi-icon-preview",u);u=tinymce.ui.Widget.extend({init:function(a){this._super(a);this.settings.className&&this.classes.add(this.settings.className)},repaint:function(){var a=this.getEl().style;var b=
this._layoutRect;var c=this._lastRepaintRect||{};var d=this.borderBox;var e=d.left+d.right+8;d=d.top+d.bottom;b.x!==c.x&&(a.left=b.x+"px",c.x=b.x);b.y!==c.y&&(a.top=b.y+"px",c.y=b.y);b.w!==c.w&&(a.width=b.w-e+"px",c.w=b.w);b.h!==c.h&&(a.height=b.h-d+"px",c.h=b.h);this._lastRepaintRect=c;this.fire("repaint",{},!1);return this},renderHtml:function(){return f("<div>").attr("id",this._id).addClass(this.classes.toString()).append(f("<p>").html(this.settings.message))[0].outerHTML}});tinymce.ui.Factory.add("agsdi-message",
u);g.on("preInit",function(){g.parser.addNodeFilter("span",G(!0));g.serializer.addNodeFilter("span",G(!1));var a=g.formatter.get("link"),b=a[0].onformat;a.push(Object.assign({},a[0],{selector:"span.agsdi-icon",ceFalseOverride:!0,onformat:function(){var c=arguments[0];arguments[0]=f("<a>").append(f(arguments[0]).clone())[0];b.apply(null,arguments);g.dom.replace(arguments[0],c);g.selection.select(arguments[0])},onmatch:null}));g.formatter.register("link",a);g.selection.selectorChanged("a > span.agsdi-icon",
function(c,d){c&&d.parents&&d.parents[1]&&g.selection.select(d.parents[1])})});g.addButton("agsdi_icons",{icon:"agsdi",tooltip:wp.i18n.__("Insert Icon","ds-icon-expansion"),onclick:z(g).open,stateSelector:"span.agsdi-icon"});g.addCommand("agsdi_icon",function(){z(g).open()});g.on("mouseup",function(a){var b=a.target;"SPAN"===b.nodeName&&f(b).hasClass("agsdi-icon")?2!==a.button&&(f(b).data("agsdi-selected")?z(g).open():(A(),f(b).data("agsdi-selected",1))):A()});g.on("ResolveName",function(a){var b=
a.target;"SPAN"===b.nodeName&&f(b).hasClass("agsdi-icon")&&(a.name="icon")});g.on("PostProcess",function(a){a.get&&A()})});tinymce._agsdi_init=tinymce.init;tinymce.init=function(g){window.tinyMCEPreInit||(g.content_css=g.content_css?g.content_css+(","+ags_divi_icons_config.mceStyles):ags_divi_icons_config.mceStyles,g.toolbar&&(g.plugins+=" agsdi_icons",g.toolbar+=",agsdi_icons"));return tinymce._agsdi_init(g)}})();
function agsdi_filter(f,k){if(k=jQuery(k).val()){k=k.split(",");var t=jQuery("#"+f+"-agsdi-filter-style");t.length||(t=jQuery("<style>").attr("id",f+"-agsdi-filter-style").appendTo("head:first"));for(var q="#"+f+" .agsdi-icons [data-icon],#"+f+" .agsdi-icons [data-icon-pre]{ display: none; }",g=0;g<k.length;++g)q+="#"+f+' .agsdi-icons [data-icon^="'+k[g]+'"], #'+f+' .agsdi-icons [data-icon-pre^="'+k[g]+'"]{ display: inline-block; }';t.text(q)}else jQuery("#"+f+"-agsdi-filter-style").remove();jQuery("#"+
f+" .agsdi-icons:first").trigger("agsdi:filter")};
